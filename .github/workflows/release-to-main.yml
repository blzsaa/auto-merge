
name: release to main
on:
    push:
      branches:
        - release
jobs:
    createPullRequest:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
  
        # - name: Create Pull Request
        #   id: cpr
        #   uses: peter-evans/create-pull-request@v6
        #   with:
        #     token: ${{ secrets.REPO_SCOPE }}
        #     author: ${{ github.actor }} <${{ github.actor_id }}+${{ github.actor }}@users.noreply.github.com>
        #     signoff: false
        #     branch: main
        #     base: release
        #     delete-branch: false
        #     title: 'NO_REF: release to main'
        #     body: |
        #       - Auto-generated by [create-pull-request][1]
  
        #       [1]: https://github.com/peter-evans/create-pull-request
        #     labels: |
        #       report
        #       automated pr
        #     draft: false

        # - name: Create Pull Request2
        #   run: |
        #       gh pr create --title "Automated PR: Merge changes from release to master" \
        #                    --body "This PR was automatically created to merge changes from the release branch into master." \
        #                    --base main \
        #                    --head release
        #   env:
        #       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

        - name: Create Pull Request
          id: create_pr
          run: |
            pr_url=$(gh pr create --title "Automated PR: Merge changes from release to main" \
                                    --body "This PR was automatically created to merge changes from the release branch into main." \
                                    --base main \
                                    --head release)
            pr_number=$(echo $pr_url | awk -F"/" '{print $NF}')
            echo "::set-output name=pr_number::$pr_number"
          env:
            GITHUB_TOKEN: ${{ secrets.REPO_SCOPE }}

        - name: Merge Pull Request
          if: steps.create_pr.outputs.pr_number != ''  # Only merge if a pull request was created
          run: gh pr merge ${{ steps.create_pr.outputs.pr_number }} --auto --merge
          env:
            GITHUB_TOKEN: ${{ secrets.REPO_SCOPE }}
